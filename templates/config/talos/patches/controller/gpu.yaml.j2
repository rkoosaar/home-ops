# Labels + kernel args + system extensions for Intel iGPU on all controllers
machine:
  kubelet:
    nodeLabels:
      intel.feature.node.kubernetes.io/gpu: "true"
      topology.kubernetes.io/region: "main"

  schematic:
    customization:
      extraKernelArgs:
        - -init_on_alloc # Less security, faster puter
        - -init_on_free # Less security, faster puter
        - -selinux # Less security, faster puter
        - apparmor=0 # Less security, faster puter
        - i915.enable_guc=2 # Meteor Lake CPU & Intel iGPU
        - init_on_alloc=0 # Less security, faster puter
        - init_on_free=0 # Less security, faster puter
        - intel_iommu=on # PCI Passthrough
        - iommu=pt # PCI Passthrough
        - mitigations=off # Less security, faster puter
        - security=none # Less security, faster puter
        - sysctl.kernel.kexec_load_disabled=1 # Meteor Lake CPU & Intel iGPU
        - talos.auditd.disabled=1 # Less security, faster puter
      systemExtensions:
        officialExtensions:
          - siderolabs/fuse3
          - siderolabs/i915
          - siderolabs/intel-ice-firmware
          - siderolabs/intel-ucode
          - siderolabs/iscsi-tools
          - siderolabs/mei
          - siderolabs/realtek-firmware
          - siderolabs/util-linux-tools
          - siderolabs/nfsrahead # NFS Performance
